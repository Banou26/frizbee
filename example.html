<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Frizbee WASM Example</title>
    <style>
        body { 
            font-family: Arial, sans-serif; 
            max-width: 800px; 
            margin: 50px auto; 
            padding: 20px;
        }
        input { 
            width: 100%; 
            padding: 10px; 
            font-size: 16px; 
            margin-bottom: 20px;
        }
        .results { 
            border: 1px solid #ddd; 
            padding: 10px; 
            min-height: 200px;
            background: #f5f5f5;
        }
        .match { 
            padding: 5px; 
            margin: 5px 0;
            background: white;
            border-radius: 3px;
        }
        .highlighted {
            background-color: yellow;
            font-weight: bold;
        }
    </style>
</head>
<body>
    <h1>Frizbee WASM Fuzzy Search Demo</h1>
    <input type="text" id="searchInput" placeholder="Type to search...">
    <div id="results" class="results"></div>

    <script type="module">
        import init, { 
            WasmMatcher, 
            create_default_config,
            create_custom_config,
            create_custom_scoring
        } from './pkg/frizbee_wasm.js';

        async function run() {
            await init();

            const matcher = new WasmMatcher();
            
            // You can use default config
            const defaultConfig = create_default_config();
            
            // Or create a custom config
            const customConfig = create_custom_config(
                true,  // prefilter
                1,     // max_typos (1 typo allowed)
                true,  // sort results
                null   // use default scoring
            );
            
            // Or create custom scoring parameters
            const strictScoring = create_custom_scoring(
                20,    // higher match score
                8,     // higher mismatch penalty
                10,    // higher gap open penalty
                4,     // gap extend penalty
                10,    // prefix bonus
                5,     // offset prefix bonus
                5,     // capitalization bonus
                3,     // matching case bonus
                30,    // exact match bonus
                10,    // delimiter bonus
                " /._-@" // delimiters including @
            );
            
            // Use custom scoring in config
            const strictConfig = create_custom_config(
                true,
                0,     // no typos allowed
                true,
                strictScoring
            );
            
            // Sample data to search
            const items = [
                "hello_world.js",
                "HelloWorldComponent.tsx", 
                "main.rs",
                "package.json",
                "README.md",
                "src/components/Button.tsx",
                "src/utils/helpers.js",
                "tests/unit/example.test.js",
                "config/webpack.config.js",
                "node_modules/react/index.js"
            ];

            const searchInput = document.getElementById('searchInput');
            const resultsDiv = document.getElementById('results');

            searchInput.addEventListener('input', (e) => {
                const needle = e.target.value;
                
                if (needle.length === 0) {
                    resultsDiv.innerHTML = '<p>Type to search...</p>';
                    return;
                }

                try {
                    // Use customConfig instead of defaultConfig for more control
                    const matches = matcher.matchList(needle, items, customConfig);
                    
                    if (matches.length === 0) {
                        resultsDiv.innerHTML = '<p>No matches found</p>';
                    } else {
                        resultsDiv.innerHTML = matches
                            .map(match => {
                                const item = items[match.index];
                                // Get match indices for highlighting
                                const indices = matcher.matchIndices(needle, item, customConfig);
                                
                                let highlighted = item;
                                if (indices && indices.indices) {
                                    // Build highlighted string
                                    let result = '';
                                    let lastIndex = 0;
                                    for (const idx of indices.indices) {
                                        result += item.slice(lastIndex, idx);
                                        result += `<span class="highlighted">${item[idx]}</span>`;
                                        lastIndex = idx + 1;
                                    }
                                    result += item.slice(lastIndex);
                                    highlighted = result;
                                }
                                
                                return `<div class="match">
                                    ${highlighted} 
                                    <small>(score: ${match.score})</small>
                                </div>`;
                            })
                            .join('');
                    }
                } catch (error) {
                    resultsDiv.innerHTML = `<p>Error: ${error.message}</p>`;
                }
            });
        }

        run();
    </script>
</body>
</html>